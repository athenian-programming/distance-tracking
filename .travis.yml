sudo: required
dist: trusty
branches:
  only:
    - master

language: python
python:
  - "2.7"
  - "3.6"

env:
  global:
    - GOPATH=$HOME/go
    - PATH=$PATH:$GOROOT/bin:$GOPATH/bin
    - PYTHONPATH=${PYTHONPATH}:${HOME}/common-robotics
    - PYTHONWARNINGS="ignore"

before_install:
  - sudo apt-get -qq update
  - sudo apt-get install autoconf automake libtool curl make g++ unzip
  - gimme 1.8

install:
  - git clone https://github.com/athenian-robotics/common-robotics.git $HOME/common-robotics
  - pip install -r requirements.txt
  - pip install -r http-client-requirements.txt
  - go get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-grpc-gateway
  - go get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-swagger
  - go get -u github.com/golang/protobuf/protoc-gen-go
  - go get -u google.golang.org/grpc
  - bin/install-protobuf.sh
  - make codegen

before_script:
  - ./impl/grpc_distance_server.py --count 10000 --delay .1 &
  - go run http_proxy.go -stderrthreshold=INFO -logtostderr=true &

script:
  - ./http_distance_client.py --count 100
  - ./distance_client.py --count 100

